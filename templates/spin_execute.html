{% extends "layout.html" %}

{% block css %}
    <link rel="stylesheet" href="/static/wheel.css">
{% endblock %}

{% block content %}
    <div class="row justify-content-center">
    <div class="col-sm-10">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Zap Spin</h3>
        </div>
        <div class="card-body">
            Bet: {{ spin.bet / 100 }} ZAP
            <br/>
            Multiplier: {{ spin.multiplier }}x
            <br/>
            Win: {{ spin.bet / 100 * spin.multiplier }} ZAP
            <br/>
            <div class="d-flex justify-content-center">
                <div id="wheelOfFortune">
                    <canvas id="wheel" width="300" height="300"></canvas>
                    <div id="spin"></div>
                </div>
            </div>
            <span id="result"></span>
        </div>
    </div>
    </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" id="winModal">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Congratulations!</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body d-flex justify-content-center">
                <div id="qrcode" class="d-flex justify-content-center">
                    <a href="{{ url }}">
                        <div class="d-flex justify-content-center">
                            {{ qrcode_svg | safe }}
                        </div>
                        <br/>
                        <p>Scan the QR code or click the link to claim your {{ spin.bet / 100 * spin.multiplier }} ZAP.</p>
                        <br/>
                    </a>
                </div>
            </div>
          </div>
        </div>
      </div>
{% endblock %}

{% block scripts %}
    <script src="/static/wheel.js"></script>
    <script>
        wheelInit(wheelSectors(10, 10 / {{ spin.multiplier }}), 1000, {{ spin.win | tojson }}, function() {
            const EL_result = document.querySelector("#result");
            if ({{ spin.win | tojson }}) {
                if ({{ (spin.payout_txid != None) | tojson }})
                    EL_result.innerHTML = "already claimed win";
                else
                    $('#winModal').modal();
            }
            else
                EL_result.innerHTML = "better luck next time";
        });
    </script>
{% endblock %}
